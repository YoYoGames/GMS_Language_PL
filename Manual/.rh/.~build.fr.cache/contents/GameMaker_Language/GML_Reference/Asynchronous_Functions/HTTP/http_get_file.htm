
  
  http_get_file
  Za pomocą tej funkcji można połączyć się z podanym adresem URL w celu pobrania informacji w postaci pliku. Ponieważ jest to funkcja asynchroniczna, GameMaker Studio 2 nie zablokuje się w oczekiwaniu na odpowiedź, lecz będzie działać dalej, dopóki nie otrzyma informacji zwrotnej. Informacja ta będzie miała postać string i wywoła zdarzenie asynchroniczne w każdej instancji, która ma je zdefiniowane we właściwościach object.
  UWAGA Należy pamiętać, że ze względu na ochronę XSS w przeglądarkach, żądania i próby załadowania zasobów z innych domen są blokowane i mogą zwracać puste wyniki. Więcej informacji na ten temat można znaleźć w części poświęconej problemom domen krzyżowych.
  Zdarzenie to wygeneruje "wywołanie zwrotne", które zostanie odebrane przez dowolne zdarzenie HTTP, w którym to przypadku wygeneruje ono wartość DS Map (bardziej znany jako "słownik"), który jest wyłączny dla tego zdarzenia i jest przechowywany w specjalnej zmiennej async_load. Ta mapa DS będzie zawierać różne wartości w zależności od zwracanych danych, tzn. zdarzenie będzie wyzwalane wielokrotnie po odebraniu każdego pakietu danych, dzięki czemu będzie można na przykład wyświetlić pasek postępu. Ogólna struktura mapy DS będzie następująca:
  
    id: Identyfikator, który został zwrócony przez polecenie. Jeśli wystrzelisz serię żądań http_, musisz wiedzieć, na które z nich otrzymasz odpowiedź, dlatego użyjesz tej wartości do porównania z wartością zapisaną podczas wysyłania żądania, aby znaleźć właściwe żądanie.
    status: Zwraca wartość mniejszą niż 0 w przypadku błędu, 0 w przypadku zakończenia i 1 w przypadku odebrania pakietów (więcej szczegółów w dalszej części instrukcji).
    wynik: Odebrane dane (tylkostring ).
    url: Pełny adres URL żądany przez użytkownika.
    http_status: Nieprzetworzony kod statusu http (jeśli jest dostępny). Zwraca on standardowy kod statusu dla większości przeglądarek, np. 304 dla "Not Modified" lub 204 dla "No Content", itd.
  
  Jeśli do gry zwracanych jest wiele pakietów, klawisz wywołania zwrotnego "status" zwróci 1. W takim przypadku mapa DS będzie miała następujące dodatkowe klawisze:
  
    "contentLength": Jest to rozmiar pliku, którego zgodnie z informacją zawartą na stronie server należy się spodziewać (może być -1, jeśli strona server nie zwraca tych danych).
    "sizeDownloaded": Rozmiar danych, które zostały już pobrane.
  
   
  Składnia:
  http_get_file(url, local_target);
  
    
      
        Argument
        Typ
        Opis
      
      
        url
        String
        The web address of the server that you wish to get file from
      
      
        local_target
        String
        The local storage path to save the file to
      
    
  
   
  Zwroty:
  Async Request ID
   
  Przykład rozszerzony:
  Funkcję http_get_file() można wywołać z dowolnego zdarzenia, a ponieważ jest to funkcja asynchroniczna, wywołanie zwrotne może być niemal natychmiastowe lub może trwać kilka sekund. Wywołanie funkcji jest proste i wygląda mniej więcej tak:
  file = http_get_file("http://www.macsweeneygames.com/downloads/upgrade.zip", "\Downloads\Upgrade.zip");
  Powyższy kod zażąda pliku z podanego adresu URL i ustawi jego pobranie do lokalnego obszaru przechowywania danych (określonego w Opcjach gry HTML5), do katalogu "Downloads" o podanej nazwie pliku (nie musi to być ta sama nazwa, co nazwa pliku źródłowego, ale powinna używać tego samego pliku extension). Indeks mapy async_load zostanie zapisany w zmiennej "file", co umożliwi sprawdzenie poprawności wywołania zwrotnego w zdarzeniu asynchronicznym, a jeśli katalog zapisu nie istnieje, zostanie utworzony. Wywołanym zdarzeniem asynchronicznym będzie zdarzenie podrzędne HTTP, a w nim pojawi się coś takiego jak poniżej:
  if ds_map_find_value(async_load, "id") == file
    {
        var status = ds_map_find_value(async_load, "status");
        if status == 0
        {
            var path = ds_map_find_value(async_load, "result");
            var files = zip_unzip(path, "/NewContent/");
            if files > 0
            {
                global.ExtraContent = true;
            }
        }
    }
  Powyższy kod najpierw sprawdzi "id" utworzonej mapy ds_map, a następnie sprawdzi stan wywołania zwrotnego. Jeśli wartość jest równa 0 (co sygnalizuje powodzenie), wynik wywołania zwrotnego zostanie użyty wraz z funkcją zip_unzip() do rozpakowania pobranego pliku do podanego katalogu. Jeśli rozpakowanie zakończy się sukcesem, zmienna globalna zostanie ustawiona na wartość true.
   
   
   
  
    
      
        Powrót: HTTP
        Następny: http_post_string
      
    
    © Copyright YoYo Games Ltd. 2022 Wszystkie prawa zastrzeżone.
  
  
  

