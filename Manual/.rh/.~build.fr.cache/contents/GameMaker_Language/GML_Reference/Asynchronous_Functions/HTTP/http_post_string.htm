
  
  http_post_string
  W informatyce funkcja post request jest używana, gdy klient musi wysłać dane do server jako część żądania pobrania, np. przy wysyłaniu pliku lub wypełnianiu formularza, i tak samo jest w przypadku tej funkcji w GameMakerze. W odróżnieniu od metody żądania http_get(), w której do server wysyłany jest tylko adres URL, http_post_string() zawiera również adres string, który jest wysyłany do server i może skutkować utworzeniem nowego zasobu lub aktualizacją istniejącego zasobu albo jednym i drugim. Należy zauważyć, że parametry żądania HTTP (fragmenty czasami "dołączane" do końca adresu URL, gdy użytkownik przesyła formularz na stronie internetowej) są również całkowicie dopuszczalne przy korzystaniu z tej funkcji.
  UWAGA Należy pamiętać, że ze względu na ochronę XSS w przeglądarkach, żądania i próby załadowania zasobów z innych domen są blokowane i mogą zwracać puste wyniki. Więcej informacji na ten temat można znaleźć w części poświęconej problemom domen krzyżowych.
  Zdarzenie to wygeneruje "wywołanie zwrotne", które zostanie odebrane przez dowolne zdarzenie HTTP, w którym to przypadku zostanie wygenerowana mapa DS (bardziej znana jako "słownik"), która jest wyłączna dla tego zdarzenia i jest przechowywana w specjalnej zmiennej async_load. Ta mapa DS będzie zawierać różne wartości w zależności od tego, czy zwracane są dane, czy nie. Na przykład, jeśli użytkownik zażądał pliku, zdarzenie będzie wyzwalane wielokrotnie po odebraniu każdego pakietu danych, dzięki czemu można na przykład wyświetlić pasek postępu. Ogólna struktura mapy DS jest następująca:
  
    id: Identyfikator, który został zwrócony przez polecenie. Jeśli wystrzelisz serię żądań http_, musisz wiedzieć, na które z nich otrzymasz odpowiedź, dlatego użyjesz tej wartości do porównania z wartością zapisaną podczas wysyłania żądania, aby znaleźć właściwe żądanie.
    status: Zwraca wartość mniejszą niż 0 w przypadku błędu, 0 w przypadku zakończenia i 1 w przypadku odebrania pakietów (więcej szczegółów w dalszej części instrukcji).
    wynik: Odebrane dane (tylkostring ).
    url: Pełny adres URL żądany przez użytkownika.
    http_status: Nieprzetworzony kod statusu http (jeśli jest dostępny). Zwraca on standardowy kod statusu dla większości przeglądarek, np.: 304 dla "Not Modified" lub 204 dla "No Content", itd.
  
  Jeśli do gry zwracanych jest wiele pakietów, klucz wywołania zwrotnego "status" zwróci 1. W takim przypadku mapa DS będzie miała następujące dodatkowe klucze:
  
    "contentLength": Jest to rozmiar pliku, którego zgodnie z informacją zawartą na stronie server należy się spodziewać (może być -1, jeśli strona server nie zwraca tych danych).
    "sizeDownloaded": Rozmiar danych, które zostały już pobrane.
  
   
  Składnia:
  http_post_string(url, string);
  
    
      
        ArgumentTyp
        Opis
     
      
        url
        The web address of the server that you wish to get information from
     
      
        string
        The string you wish to send to the specified URL
     
    
  
   
  Zwroty:
  Async Request ID
   
  Przykład rozszerzony:
  Funkcję http_post_string() można wywołać z dowolnego zdarzenia, a ponieważ jest to funkcja asynchroniczna, wywołanie zwrotne może być niemal natychmiastowe lub może trwać kilka sekund. Wywołanie funkcji jest proste i wygląda mniej więcej tak:
  var str = "name=" + global.player_name + "&score=" + string(global.player_score);
    post = http_post_string("http://www.angusgames.com/game?game_id=" + string(global.game_id), str);
  Powyższy kod wysyła żądanie pobrania do określonego adresu URL z podanymi parametrami, a także wysyła dodatkowe dane (nazwę gracza i wynik w postaci zakodowanej w adresie URL) przechowywane w zmiennej str. Spowoduje to uruchomienie wszystkich zdefiniowanych asynchronicznych zdarzeń Http, jeśli zostanie odebrane wywołanie zwrotne, a Ty możesz sprawdzić, czy zwrócone "id" jest zgodne z tym przechowywanym w zmiennej post, aby upewnić się, że uruchomiłeś właściwy kod, jeśli użyłeś różnych funkcji http_post_string(). Poniższy przykładowy kod pokazuje, jak można to zrobić:
  var r_str = "null";
    if ds_map_find_value(async_load, "id") == post
    {
        if ds_map_find_value(async_load, "status") == 0
        {
            r_str = ds_map_find_value(async_load, "result");
        }
    }
  Powyższy kod najpierw sprawdzi identyfikator utworzonej mapy DS, a następnie sprawdzi status wywołania zwrotnego. Jeśli wartość jest równa 0 (co sygnalizuje powodzenie), wynik wywołania zwrotnego zostanie zapisany w zmiennej do wykorzystania w przyszłości, w przeciwnym razie zmienna będzie miała wartość domyślną (w tym przypadku "null").
   
   
   
  
    
      
        Powrót: HTTP
        Następny: http_get_request_crossorigin
      
    
    © Copyright YoYo Games Ltd. 2022 Wszystkie prawa zastrzeżone.
  
  
  

